!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).proxyWebStorage={})}(this,(function(e){"use strict";let t=new WeakMap;function n(e,n,r){const o={ctx:this,fn:r};let i=t.get(e);i||t.set(e,i=new Map);const c=i.get(n);c?c.push(o):i.set(n,[o])}function r(e,t,r){const i=this,c=(n,s)=>{o(e,t,c),r.call(i,n,s)};c.fn=r,n(e,t,c)}function o(e,n,r){if(void 0===n)return void t.set(e,new Map);let o=t.get(e);if(o){const e=o.get(n);if(e&&e.length>0){let t=[];r&&(t=e.filter((e=>!(e.fn===r||e.fn?.fn===r)))),o.set(n,t)}}}function i(e,n,...r){const o=t.get(e);if(o){const e=o.get(n);if(e){const[t,n]=r;e.forEach((e=>e.fn.call(e.ctx,t,n)))}}}const c=Array.isArray,s=e=>null!==e&&"object"==typeof e,l=e=>"string"==typeof e&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,a=e=>Object.prototype.toString.call(e),u=(e,t)=>!Object.is(e,t);function f(e){try{return JSON.parse(e)}catch(t){return e}}const p=Object.prototype.hasOwnProperty,g=(e,t)=>p.call(e,t);function d(e){return(0,eval)(e)}let y="";const w=new WeakMap,h={storage:{},key:"",proxy:{}};let x=!0;function S(e,t){return function(){delete e[t]}}function v(e,t,...n){let r=`${h.key}.${t}`;c(e)&&l(t)&&(r=`${h.key}[${t}]`),i(h.storage,r,...n)}let b=!1;const k=function(){const e={};return["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){b=!0;const n=this.length,r=w.get(this)[t].apply(this,e);return this.length>n&&v(this,"length",this.length,n),b=!1,r}})),e}();function m(e,t,n){return c(e)&&g(k,t)?Reflect.get(k,t,n):Reflect.get(e,t,n)}function E(e){x=!1;let t=h.proxy.getExpires(h.key);h.proxy[h.key]=e,t&&h.proxy.setExpires(h.key,t),x=!0}function $(e,t,n,r){let o;c(e)&&!b&&(o=e.length);const i=e[t],s=c(e)&&l(t)?Number(t)<e.length:g(e,t),a=Reflect.set(e,t,n,r);return a&&u(n,i)&&(v(e,t,n,s?i:void 0),c(e)&&void 0!==o&&Number(t)>=o&&v(e,"length",e.length,o),E(e)),a}function O(e,t){const n=g(e,t),r=e[t],o=Reflect.deleteProperty(e,t);return o&&n&&(v(e,t,void 0,r),E(e)),o}function j(e){const t=new Proxy(e,{get:m,set:$,deleteProperty:O});return w.set(t,e),t}const P={String:{read:e=>e,write:e=>e},Number:{read:e=>Number.parseFloat(e),write:e=>String(e)},BigInt:{read:e=>BigInt(e),write:e=>String(e)},Boolean:{read:e=>"true"===e,write:e=>String(e)},Null:{read:()=>null,write:e=>String(e)},Undefined:{read:()=>{},write:e=>String(e)},Object:{read:e=>j(e),write:e=>e},Array:{read:e=>j(e),write:e=>e},Set:{read:e=>new Set(e),write:e=>Array.from(e)},Map:{read:e=>new Map(e),write:e=>Array.from(e)},Date:{read:e=>new Date(e),write:e=>String(e)},RegExp:{read:e=>d(e),write:e=>String(e)},Function:{read:e=>d(`(function() { return ${e} })()`),write:e=>String(e)}};function D(e,t){let n=e;try{n=f(e)}catch(e){}if(!s(n))return n;if(n.expires&&new Date(+n.expires).getTime()<=Date.now())return void t();const r=P[n.type];return r?r.read(n.value):n.value}function N(e,t){const n=a(e).slice(8,-1);const r=P[n];if(!r)throw new Error(`can't set "${n}" property.`);let o={type:n,value:r.write(e)};return t&&(o.expires=t),JSON.stringify(o)}function R(e,t,n,r){let o;if(o="[object Date]"===a(n)?n.getTime():(e=>"string"==typeof e)(n)?+n.padEnd(13,"0"):n,o<=Date.now())return void delete r[t];let i=r[t];return i?(i=w.get(i)||i,e[`${t}`]=N(i,""+o),new Date(o)):void 0}function M(e,t){const n=`${t}`;if(!e[n])return;let r=f(e[n]);return!s(r)||!r.expires||+r.expires<=Date.now()?void 0:new Date(+r.expires)}function I(e,t,n){let r=n[t];r&&(r=w.get(r)||r,e[`${t}`]=N(r))}let V;function A(e,t,i){if(x&&(h.storage=e,h.key=t,h.proxy=i),V||(V=function(e,t){const i={};["clear","key"].forEach((t=>{i[t]=e[t].bind(e)}));const c={getItem:A,setItem:T,setExpires:R,removeExpires:I};Object.keys(c).forEach((n=>{i[n]=function(...r){return c[n](e,...r,t)}}));const s={removeItem:B,getExpires:M,off:o,on:n,once:r};return Object.keys(s).forEach((t=>{i[t]=function(...n){return s[t](e,...n)}})),i}(e,i)),g(V,t))return Reflect.get(V,t,i);if(!W(e,t))return;const c=`${t}`,s=e[c]||e[t];return s?D(s,S(e,c)):s}function T(e,t,n,r){const o=`${t}`;let c=D(e[o],S(e,o));c=w.get(c)||c;const s=N(n),l=Reflect.set(e,o,s,r);return l&&u(n,c)&&x&&i(e,t,n,c),l}function W(e,t){return e.hasOwnProperty(`${t}`)||(r=t,!(n=e).hasOwnProperty(r)&&r in n);var n,r}function B(e,t){const n=`${t}`,r=g(e,n);let o=D(e[n],S(e,n));o=w.get(o)||o;const c=Reflect.deleteProperty(e,n);return c&&r&&i(e,t,void 0,o),c}function F(e){if(!e)return null;return new Proxy(e,{get:A,set:T,has:W,deleteProperty:B})}const J=F(localStorage),_=F(sessionStorage);"undefined"!=typeof window&&window.addEventListener("storage",(e=>{if(e.key&&e.key.startsWith(y)){let t=e.newValue,n=e.oldValue;e.newValue&&(t=D(e.newValue,S(localStorage,e.key)),s(t)&&(t=w.get(t)||t)),e.oldValue&&(n=D(e.oldValue,S(localStorage,e.key)),s(n)&&(n=w.get(n)||n)),i(localStorage,e.key.slice(y.length),t,n)}})),e.local=J,e.session=_,Object.defineProperty(e,"__esModule",{value:!0})}));
